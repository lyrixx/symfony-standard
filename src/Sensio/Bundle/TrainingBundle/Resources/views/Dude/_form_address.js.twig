<script>
(function($){
    $(function() {
        var $collectionHolder = $('#dude_addresses');
        $collectionHolder.data('index', $collectionHolder.find('.address').length);

        var prototype = $collectionHolder.data('prototype');

        var $addAddressLink = $('<a href="#" class="btn btn-primary">Add an address</a>');
        $collectionHolder.append($addAddressLink);
        $addAddressLink.on('click', function(e) {
            e.preventDefault();

            var index = $collectionHolder.data('index');

            var newForm = prototype.replace(/__name__/g, index);
            $addAddressLink.before(newForm);

            $collectionHolder.data('index', index + 1);
        });
        $('.address-delete').on('click', function(e) {
            e.preventDefault();

            $(this).parents('fieldset').remove();
        });
    });
})(jQuery);
</script>
